---
# file: roles/mysql/tasks/mysql_server.yml

- name: ensure mysql_server is installed
  when: ansible_os_family == "Debian"
  apt: pkg=mysql-server state=latest
  tags:
    - mysql_server

- name: template /etc/mysql/my.cnf
  when: ansible_os_family == "Debian"
  template: src=etc-mysql-my.cnf.j2 dest=/etc/mysql/my.cnf owner=root group=root mode=0644
  notify: restart mysql
  tags:
    - mysql_server

- name: Disable Apparmor for mysql
  when: ansible_os_family == "Debian"
  file: state=link src=/etc/apparmor.d/usr.sbin.mysqld path=/etc/apparmor.d/disable/usr.sbin.mysqld
  notify: remove apparmor mysql profile
  tags:
    - mysql_server